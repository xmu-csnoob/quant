# ATR (Average True Range)

> 平均真实波幅，由 Welles Wilder 发明，衡量市场波动率的纯客观指标

---

## 一、原理（为什么需要它？）

### 金融逻辑
- **波动率测量**：ATR只衡量波动大小，不反映方向
- **风险量化**：ATR越大，单日风险越大
- **动态止损**：根据波动率调整止损距离

### 解决什么问题
- 需要量化"今天波动有多大"
- 需要根据波动率设置止损距离
- 需要判断市场是否进入高波动期（风险增大）

### 适用场景
- **止损设置**：动态止损 = 入场价 ± N倍ATR
- **仓位管理**：高波动时减仓，低波动时加仓
- **市场状态判断**：ATR上升 = 波动增大
- **突破确认**：突破当日ATR是否放大

### 指标特点
```
ATR只反映波动幅度，不反映方向

示例：
大涨：ATR ↑
大跌：ATR ↑
横盘：ATR ↓

ATR = 价格波动的"温度计"
```

---

## 二、数学公式（如何计算？）

### 计算步骤

**1. 计算"真实波幅"（True Range, TR）**

每日的TR取以下三者的最大值：

```
TR = max(
    今日最高 - 今日最低,        # 今日振幅
    |今日收盘 - 昨日收盘|,      # 昨收到今收的绝对距离
    今日最高 - 昨日收盘,        # 跳空高开
    昨日收盘 - 今日最低         # 跳空低开
)
```

**为什么需要4个值？**
- 正常日子：今日最高-今日最低
- 跳空高开：今日最高-昨日收盘（缺口也算波动）
- 跳空低开：昨日收盘-今日最低（缺口也算波动）

**2. 计算ATR（移动平均）**

```
ATR = MA(TR, n)

标准参数：n = 14
通常使用EMA而非SMA（Wilder建议）
```

### 参数说明

| 参数 | 标准值 | 可调范围 | 说明 |
|------|--------|----------|------|
| 周期 | 14 | 7-21 | 越小越敏感 |
| 平滑方式 | EMA | EMA/SMA | EMA反应更快 |

### 计算示例

```
天数 | 最高 | 最低 | 收盘 | 昨收 | TR计算 | TR值
-----|------|------|------|------|--------|-----
 1   | 12.0 | 11.0 | 11.5 | -    | 12.0-11.0=1.0 | 1.00
 2   | 12.5 | 11.2 | 12.3 | 11.5 | max(1.3, 0.8, 1.0) | 1.30
 3   | 12.8 | 11.8 | 12.0 | 12.3 | max(1.0, 0.3, 0.5) | 1.00
 4   | 13.5 | 12.0 | 13.2 | 12.0 | max(1.5, 1.2, 1.5) | 1.50
 5   | 13.2 | 12.5 | 12.8 | 13.2 | max(0.7, 0.4, 0) | 0.70

ATR(14) = 前14日TR的EMA
假设前14日TR平均值 ≈ 1.2

第15日ATR = 0.9 × 1.2 + 0.1 × 今日TR（简化EMA）
```

### 跳空示例

```
正常情况（无跳空）：
昨日: 10.00 - 11.00 (收10.50)
今日: 10.20 - 11.20
TR = 11.20 - 10.20 = 1.00

跳空高开：
昨日: 10.00 - 11.00 (收10.50)
今日: 11.30 - 12.00  ← 跳空高开
TR = max(12.00-11.30=0.7, |11.80-10.50|=1.3, 12.00-10.50=1.5)
   = 1.50  ← 包含跳空缺口！
```

---

## 三、应用（如何使用？）

### 1. 波动率判断

| ATR状态 | 市场含义 | 风险水平 |
|---------|----------|----------|
| ATR持续上升 | 波动增大 | 高风险 |
| ATR持续下降 | 波动减小 | 低风险 |
| ATR极高值 | 异常波动 | 极高风险 |
| ATR极低值 | 波动收缩 | 可能突破 |

### 2. 动态止损（核心应用）

**ATR止损法**：
```
多头止损价 = 入场价 - N × ATR
空头止损价 = 入场价 + N × ATR

N常用值：2-3
```

**示例**：
```
入场价：10.00
当前ATR：0.50
设置N=3

止损价 = 10.00 - 3 × 0.50 = 10.00 - 1.50 = 8.50

优点：
- 波动大时止损远（避免被震出局）
- 波动小时止损近（及时止损）
```

**追踪止损**：
```
每日更新止损价：

新的多头止损 = 昨日收盘 - N × ATR
但只能向上调整，不能向下

示例：
第1天：入场10.00，ATR=0.50，止损=8.50
第2天：收盘10.50，ATR=0.60，止损=max(8.50, 10.50-1.80)=8.70（上移）
第3天：收盘11.00，ATR=0.50，止损=max(8.70, 11.00-1.50)=9.50（上移）
第4天：收盘10.80，ATR=0.40，止损=max(9.50, 10.80-1.20)=9.50（不变）
```

### 3. 仓位管理

**基于ATR的仓位分配**：
```
风险金额 = 账户 × 风险比例（如2%）
每股风险 = N × ATR（如3倍ATR）

仓位 = 风险金额 / 每股风险

示例：
账户：100,000
风险比例：2% = 2,000
ATR：0.50
N：3

每股风险 = 3 × 0.50 = 1.50
仓位 = 2,000 / 1.50 = 1,333股
```

### 4. 突破确认

```
突破当日的ATR是否放大？

真突破：
- 突破日ATR > 平均ATR
- 伴随放量
- 突破后持续强势

假突破：
- 突破日ATR正常或偏小
- 缩量
- 突破后很快回落
```

### 5. 市场状态识别

```
ATR上升 + 价格上涨 → 牛市加速
ATR上升 + 价格下跌 → 熊市恐慌
ATR下降 + 价格横盘 -> 蓄势待发
ATR下降 + 价格趋势 -> 趋势衰竭
```

### 6. ATR通道

```
ATR上轨 = 价格 + N × ATR
ATR下轨 = 价格 - N × ATR

应用：
- 类似布林带，但基于ATR而非标准差
- 更简洁的通道
```

### A股实战注意事项

1. **T+1影响**：
   - 当日无法止损，需要考虑隔夜风险
   - ATR止损应该设置更宽一些（N=3-4）

2. **涨跌停影响**：
   - 涨停日ATR可能偏小（波动受限）
   - ATR会低估实际波动风险
   - 需要考虑"如果没涨停会波动多少"

3. **A股特色**：
   - 权证、期权ATR极大
   - ST股ATR反而小（涨跌停5%）
   - 新股上市ATR异常大

4. **参数调整**：
   - 大盘股：ATR(14)
   - 小盘股：ATR(10)
   - 期权/期货：ATR(20)

### 常见陷阱

| 陷阱 | 说明 | 应对 |
|------|------|------|
| ATR不反映方向 | ATR上升不等于上涨 | 结合价格趋势判断 |
| 滞后性 | ATR变化慢于实际波动 | 结合K线振幅 |
| 跳空影响 | 跳空日ATR可能异常大 | 使用中位数而非均值 |
| 止损过宽 | 波动大时止损太远 | 结合支撑位调整 |

---

## 四、学习资源

### 书籍
- **《技术交易系统中的新概念》** - Welles Wilder 原著
- **《以交易为生》** 第7章 - 风险管理
- **《均线系统与ATR止损》** - ATR实战应用

### 在线教程
- [Investopedia: Average True Range (ATR)](https://www.investopedia.com/terms/a/atr.asp)
- [东方财富：ATR指标](https://www.eastmoney.com/)

### 视频课程
- B站："ATR止损策略详解"
- YouTube："ATR Trading Strategy"

### 实战练习
1. 对比不同股票的ATR值
2. 计算ATR止损并回测
3. 观察ATR与大盘指数的关系

---

## 速查表

| ATR值 | 市场状态 | 操作建议 |
|-------|----------|----------|
| ATR持续上升 | 波动增大 | 减仓/放宽止损 |
| ATR持续下降 | 波动减小 | 加仓/正常止损 |
| ATR极高 | 异常波动 | 谨慎/观望 |
| ATR极低 | 波动收缩 | 准备突破 |
| 止损设置 | 入场价±N×ATR | N=2-3 |

---

## 下一步学习

掌握ATR后，继续学习：
- [06. 成交量指标](./06-volume-indicators.md) - 量价配合
- [04. 布林带](./04-bollinger-bands.md) - 波动率与价格结合
- [02. MACD](./02-macd.md) - 趋势判断

---

**要点总结**：
- ATR衡量波动幅度，不反映方向
- 核心应用：动态止损 = 入场价 ± N×ATR
- ATR上升=高风险，ATR下降=低风险
- A股T+1需要更宽止损（N=3-4）
- 突破需要ATR配合放大
