# AI辅助开发治理计划

## 目标
解决"Agent产出速度快，但人类理解/掌控感被抽空"的问题，建立可验证证据驱动的开发流程。

## 背景
- 问题：PR动辄2000+行，人类无法有效review
- 根因：产出（LLM写代码）是并行的，验证（人类评审）是串行的
- 方案：把"可信"从模型转移到"可验证证据"（tests/静态分析/规则/运行结果）

## 阶段划分

### Phase 1: 立即做（本周完成）

#### 1.1 PR模板改造
- **目标**: 加入"可验证验收标准"必填项
- **输出**: `.github/PULL_REQUEST_TEMPLATE.md` 改造
- **验收标准**:
  - [ ] 模板包含4个必填section
  - [ ] CI检查这些section是否填写（非空）

#### 1.2 PR大小限制
- **目标**: 超过500行需要拆分
- **输出**: `.github/workflows/pr-size-check.yml`
- **验收标准**:
  - [ ] 超过500行的PR会被CI标记为失败
  - [ ] 提供豁免机制（紧急修复可override）

### Phase 2: 短期做（2周内完成）

#### 2.1 Agent产出测试
- **目标**: 新增核心逻辑必须附带测试
- **输出**:
  - `tests/` 目录结构规范
  - CI检查测试覆盖率变化
- **验收标准**:
  - [ ] 核心模块有测试覆盖
  - [ ] PR提交时检查测试是否通过

#### 2.2 分诊式Review
- **目标**: AI指出高风险点+复现路径，不做最终裁判
- **输出**:
  - `.github/REVIEW_CHECKLIST.md`
  - 可能的AI review脚本/配置
- **验收标准**:
  - [ ] Review checklist覆盖核心风险点
  - [ ] 高风险点必须有复现路径

### Phase 3: 中期做（1个月内完成）

#### 3.1 引入Semgrep
- **目标**: diff-aware的安全/质量扫描
- **输出**: `.github/workflows/semgrep.yml`
- **验收标准**:
  - [ ] 只报告本次变更引入的新问题
  - [ ] 关键安全规则启用

#### 3.2 建立回归用例库
- **目标**: 历史事故seeded bugs
- **输出**: `tests/regression/` 目录
- **验收标准**:
  - [ ] 记录历史事故并转化为测试用例
  - [ ] CI运行回归测试

## 关键依赖
- GitHub Actions CI/CD
- Semgrep (免费版)
- 测试框架 (pytest)

## 风险与回滚
- **风险**: PR大小限制可能影响紧急修复速度
- **回滚**: 提供label豁免机制 (`emergency-override`)

## 成功指标
1. 平均PR大小 < 300行
2. 所有PR都有可验证的验收标准
3. 核心模块测试覆盖率 > 60%
4. 零"黑盒PR"合入
